# vim: filetype=zsh

# Ejemplo de uso:
# mount_sshfs cisne SWAN
#
# Parámetros obligatorios
local user="$1"    # usuario remoto: cisne
local host="$2"    # host remoto: SWAN

if [[ -z "$user" || -z "$host" ]]; then
    echo "Uso: kzmount-ssh <usuario> <host>"
    return 1
fi

# Ruta de montaje
local mount_point="/mnt/servers/$host/$user"
sudo mkdir -p "$mount_point"
sudo chown $USER:$USER /mnt/servers

# Montaje SSHFS
sshfs "$user@$host:/home/$user" "$mount_point" \
    -o reconnect,ServerAliveInterval=15,ServerAliveCountMax=3

if [[ $? -eq 0 ]]; then
    echo "  Montaje completado: $user@$host -> $mount_point"
else
    echo "  Error al montar $user@$host"

    # Eliminar la carpeta creada para no ensuciar /mnt
    rmdir "$mount_point" 2>/dev/null
fi
