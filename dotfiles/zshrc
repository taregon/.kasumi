# Habilitar profiling
zmodload zsh/zprof
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
# â•šâ•â•â–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
#   â–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
#  â–ˆâ–ˆâ–ˆâ•”â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
# â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
# â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# POWERLEVEL10K INSTANT PROMPT
# Este bloque debe estar cerca del inicio de ~/.zshrc para
# que el prompt se cargue lo antes posible al abrir la terminal.
# NOTA: cualquier cÃ³digo que requiera interacciÃ³n de usuario
# (passwords, confirmaciones [y/n], etc.) debe ir **antes** de este bloque.
#
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
    source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ZINIT BOOTSTRAP
# ConfiguraciÃ³n inicial de Zinit: instala el gestor si no existe
# y lo deja listo para cargar plugins.
#
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# CONFIGURACIÃ“N PERSONAL
# Definir ruta base para archivos de configuraciÃ³n adicionales
local ZSH_CONF=~/.config/zsh

# Cargar alias y funciones personalizados
source $ZSH_CONF/kasumi-zsh_alias.conf
source $ZSH_CONF/kasumi-zsh_functions.conf
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# AUTO COMPLETADO
# Este cÃ³digo verifica si necesita reconstruir el cachÃ© de completado (.zcompdump):
# 1. Si .zcompdump no existe o es mÃ¡s antiguo que .zshrc:
#    - Se carga compinit con seguridad (-Uz)
#    - Se inicializa el sistema ignorando archivos inseguros (-i)
# 2. Si .zcompdump existe y es mÃ¡s reciente que .zshrc:
#    - Se usa el cachÃ© existente (-C) para una carga mÃ¡s rÃ¡pida
#    - Omite las verificaciones de seguridad para mejor rendimiento
#
# Esto asegura que el sistema de completado siempre estÃ© sincronizado con
# tus configuraciones actuales en .zshrc
#
if [[ ! -f ~/.zcompdump || ~/.zcompdump -ot ~/.zshrc ]]; then
    autoload -Uz compinit && compinit -i
else
    # carga rÃ¡pida sin chequear seguridad de archivos
    compinit -C
fi

# Registro de Zinit en el sistema de completado
autoload -Uz _zinit
(( ${+_comps} )) && _comps[zinit]=_zinit

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   ConfiguraciÃ³n de TERM para habilitar
#   pre visualizaciÃ³n de imÃ¡genes en Ranger segÃºn la terminal
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# Se verifica si la sesiÃ³n actual corresponde a Kitty.
# La variable KITTY_WINDOW_ID es proporcionada automÃ¡ticamente por Kitty
# y contiene un identificador Ãºnico de la ventana.
# Se usa para que aplicaciones como ranger puedan determinar
# que el protocolo de imÃ¡genes de Kitty puede ser empleado.
#
if [[ "$KITTY_WINDOW_ID" != "" ]]; then
    # Si se estÃ¡ en Kitty, se ajusta TERM a xterm-kitty.
    # Esto es obligatorio para que ranger reconozca la terminal
    # y se puedan mostrar pre visualizaciones de imÃ¡genes.
    export TERM="xterm-kitty"
else
    # Para cualquier otra terminal (alacritty, gnome-terminal, etc.)
    # se utiliza xterm-256color para mantener soporte completo de colores.
    export TERM="xterm-256color"
fi
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# â–„â–€â–€â–€â–€ â–ˆâ–€â–€â–€â–€ â–€â–€â–ˆâ–€â–€ â–€â–€â–ˆâ–€â–€ â–€â–€â–ˆâ–€â–€ â–ˆâ–„  â–ˆ â–„â–€â–€â–€â–€ â–„â–€â–€â–€â–€
#  â–€â–€â–€â–„ â–ˆâ–€â–€     â–ˆ     â–ˆ     â–ˆ   â–ˆ â–€â–„â–ˆ â–ˆ â–€â–€â–ˆ  â–€â–€â–€â–„
# â–€â–€â–€â–€  â–€â–€â–€â–€â–€   â–€     â–€   â–€â–€â–€â–€â–€ â–€   â–€  â–€â–€â–€  â–€â–€â–€â–€
# VARIABLES DE ENTORNO

# Idioma y codificaciÃ³n (comentado porque generÃ³ error en Arch)
# export LC_ALL="en_US.UTF-8"

# RANGER
# Desactiva la carga de ajustes predeterminado para rc.conf
export RANGER_LOAD_DEFAULT_RC=FALSE

# USER AGENT
# Personalizado para scripts o utilidades
export IXOS_USER_AGENT="Mozilla/5.0 (X11; Linux x86_64; rv:105.0) Gecko/20100101 Firefox/105.0"

# EDITORES
# Definen el editor por defecto para terminal y GUI
export EDITOR="nvim"
export VISUAL="nvim"

# COLORES PARA BAT
export BAT_STYLE="full"
export BAT_THEME="base16"   # Tema de colores compatible con kitty

# COLORES PARA LESS
# Primero tienes que instalar: 'source-highlight'
# export LESSOPEN="| /usr/bin/src-hilite-lesspipe.sh %s"
export LESSOPEN="| src-hilite-lesspipe.sh %s"      # Coloco Ãºnicamente el nombre, sino sirve, prueba con la ruta
export LESS='-MRFI'                                # Estas opciones funcionan en man (en realidad la aplica globalmente)

# COLORES PARA MAN
# Configuraciones que aplican tanto a man como a grep
# export LS_COLORS="*.zip=36:*.rar=36:*.tar=36:*.gz=36:*.tar.gz=36:*.7z=36:$LS_COLORS"
export GREP_COLORS="mt=1;33"              # Resalta en negrita y amarillo las bÃºsquedas con grep
export MANROFFOPT='-c'                    # Activa color en man
export LS_COLORS="ex=30;42"               # Ejecutables con fondo verde

# LESS_TERMCAP
# Controla estilos dentro de less/man
export LESS_TERMCAP_mb=$'\e[1;34m'        # Bold azul
export LESS_TERMCAP_md=$'\e[1;32m'        # Blink verde
export LESS_TERMCAP_so=$'\e[1;33m'        # Reverse video amarillo
export LESS_TERMCAP_us=$'\e[3;35m'        # Underline magenta
export LESS_TERMCAP_me=$'\e[0m'           # Reset bold/blink
export LESS_TERMCAP_se=$'\e[0m'           # Reset reverse video
export LESS_TERMCAP_ue=$'\e[0m'           # Reset underline

# Define LESS como paginador para MAN,
# con soporte de color, formato legible
# y desplazamiento fluido.
export MANPAGER='less -s -M +Gg -R --use-color'    # PregÃºntale a GPT, ya lo tunÃ©

# ------------------------------------------------------
# â–ˆâ–€â–€â–€â–€ â–€â–€â–€â–€â–ˆ â–ˆâ–€â–€â–€â–€
# â–ˆâ–€â–€   â–„â–€â–€â–€  â–ˆâ–€â–€
# â–€     â–€â–€â–€â–€â–€ â–€
# OPCIONES GENERALES DE FZF

# Generador de TEMAS para fzf
# https://vitormv.github.io/fzf-themes/

# ParÃ¡metros globales de fzf: controlan colores,
# diseÃ±o y comportamiento por defecto
export FZF_DEFAULT_OPTS="--layout=reverse"   # El prompt se abre desde arriba
export FZF_DEFAULT_OPTS=$FZF_DEFAULT_OPTS'
  --color=fg:#818F98,fg+:#C8D0D6,bg:-1,bg+:#333C42
  --color=hl:#A88E6B,hl+:#FBC06E,info:#94B8BC,marker:#FF62E0
  --color=prompt:#AFEEAE,spinner:#EA676D,pointer:#FBC06E,header:#87AFAF
  --color=border:#5E6A72,label:#5E6A72,query:#D8DEE2
  --border="sharp"
  --border-label="( ó±‹ )"
  --preview-window="sharp"
  --prompt="ó°˜§ "
  --info=right
  --marker="â€º"
  --pointer="â–’"
  --separator="â”€"
  --scrollbar="â–"
' # Fin de linea

# Alt+C (cambio de directorio)
# export FZF_ALT_C_OPTS="--preview 'eza --tree --color=always {} | head -200'"

# Ctrl+T (bÃºsqueda de archivos)
export FZF_CTRL_T_OPTS="--preview 'bat -n --color=always --line-range :500 {}'"

# ------------------------------------------------------
# â–ˆ   â–ˆ â–€â–€â–ˆâ–€â–€ â–„â–€â–€â–€â–€ â–€â–€â–ˆâ–€â–€ â–„â–€â–€â–€â–„ â–ˆâ–€â–€â–€â–„ â–ˆ   â–ˆ
# â–ˆâ–€â–€â–€â–ˆ   â–ˆ    â–€â–€â–€â–„   â–ˆ   â–ˆ   â–ˆ â–ˆâ–€â–€â–€â–„ â–€â–€â–€â–€â–ˆ
# â–€   â–€ â–€â–€â–€â–€â–€ â–€â–€â–€â–€    â–€    â–€â–€â–€  â–€   â–€ â–€â–€â–€â–€â–€
# COMMAND CONFIGURATION

# https://zsh.sourceforge.io/Doc/Release/Variables-Index.html
# https://zsh.sourceforge.io/Doc/Release/Options.html#History

PROMPT_EOL_MARK="ðŸ™"                # Define el sÃ­mbolo que se mostrarÃ¡ al final de la lÃ­nea de comandos en el prompt.
HISTFILE=~/.cache/zsh_history       # Archivo donde se guarda el historial
HISTSIZE=30000                      # Comandos que se mantienen en memoria
SAVEHIST=30000                      # Comandos que se guardan en disco
setopt APPEND_HISTORY               # Permite que mÃºltiples sesiones de terminal agreguen comandos al historial en lugar de sobrescribirlo.
setopt BANG_HIST                    # Permite tratar el carÃ¡cter '!' de manera especial durante la expansiÃ³n de comandos.
setopt COMPLETE_ALIASES             # Activa la auto completado para alias.
setopt EXTENDED_HISTORY             # Registra la marca de tiempo de cada comando en el archivo de historial en el formato ":inicio:transcurrido;comando".
setopt HIST_ALLOW_CLOBBER           # Permite que las referencias al historial sobrescriban archivos, incluso cuando CLOBBER estÃ¡ desactivado.
setopt HIST_BEEP                    # Emite un pitido cuando se accede a un historial inexistente.
setopt HIST_EXPIRE_DUPS_FIRST       # Elimina comandos duplicados cuando se alcanza el lÃ­mite de $HISTSIZE.
setopt HIST_FIND_NO_DUPS            # Evita encontrar comandos duplicados durante la bÃºsqueda en el historial.
setopt HIST_IGNORE_ALL_DUPS         # Elimina una entrada anterior en el historial si la nueva es un duplicado.
setopt HIST_IGNORE_DUPS             # Ignora comandos duplicados en la lista del historial.
setopt HIST_IGNORE_SPACE            # Ignora comandos que comienzan con un espacio.
setopt HIST_NO_STORE                # No almacena el comando `fc -l` en el historial.
setopt HIST_REDUCE_BLANKS           # Elimina espacios adicionales de cada lÃ­nea de comando antes de agregarla al historial.
setopt HIST_SAVE_NO_DUPS            # Ignora duplicados al guardar el historial en el archivo.
setopt HIST_VERIFY                  # Muestra el comando antes de ejecutarlo si se selecciona del historial.
setopt INC_APPEND_HISTORY           # Escribe en el archivo de historial de inmediato, no solo cuando la shell termina.
setopt NO_HIST_NO_FUNCTIONS         # No elimina definiciones de funciones del historial.
setopt RM_STAR_WAIT                 # Espera 10 segundos antes de ejecutar `rm` con un asterisco (*).
setopt SHARE_HISTORY                # Comparte el historial entre todas las sesiones de terminal.

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   FILTRA EL HISTORIAL DE ZSH ANTES DE GUARDARLO.
#   Solo almacena comandos que existen en el sistema
#   y que no coincidan  con los patrones definidos
#   en HISTORY_IGNORE
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# Lista de comandos a ignorar
HISTORY_IGNORE="* --help|clear|exa|exit|ls|lsd|man *|pwd|q|ranger|yt-mp3"

# Hook: decidir quÃ© comandos se guardan en el historial
zshaddhistory() {
    local line cmd
    # El comando completo sin salto de lÃ­nea
    line=${1%%$'\n'}
    cmd=${line%% *}
    # 1. Ignorar si el comando no existe
    whence "$cmd" >| /dev/null || return 1
    # 2. Ignorar si coincide con algÃºn patrÃ³n en HISTORY_IGNORE
    [[ $cmd == ${~HISTORY_IGNORE} ]] && return 1
    # 3. Guardar los demÃ¡s
    return 0
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# â–€â–€â–€â–€â–ˆ â–€â–€â–ˆâ–€â–€ â–ˆâ–„  â–ˆ â–€â–€â–ˆâ–€â–€ â–€â–€â–ˆâ–€â–€
# â–„â–€â–€â–€    â–ˆ   â–ˆ â–€â–„â–ˆ   â–ˆ     â–ˆ
# â–€â–€â–€â–€â–€ â–€â–€â–€â–€â–€ â–€   â–€ â–€â–€â–€â–€â–€   â–€
# FAST ZSHELL PLUGIN MANAGER

# Tema Powerlevel10k
zinit ice depth=1
zinit light romkatv/powerlevel10k

# FZF Tab Completion (carga bajo demanda)
# zinit ice wait lucid atpull'%atclone'
# zinit light Aloxaf/fzf-tab

# Zsh Autosuggestions (inmediata)
zinit ice wait lucid atload'!_zsh_autosuggest_start'
zinit light zsh-users/zsh-autosuggestions

# Zsh Syntax Highlighting (inmediata)
zinit ice wait lucid
zinit light zsh-users/zsh-syntax-highlighting

# Zsh Completions (carga diferida y segura)
zinit ice wait lucid blockf atpull'zinit creinstall -q .'
zinit light zsh-users/zsh-completions

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# setopt clobber                             # Permite que las redirecciones de salida sobrescriban archivos existentes sin confirmaciÃ³n.
# zstyle ':completion:*' special-dirs true   # Muestra directorios especiales ('.' y '..') durante el auto completado de rutas.
# zstyle ':completion:*:matches' group 'yes'
zstyle ':completion:*' menu select        # Habilita navegaciÃ³n por menÃº en el autocompletado (con teclas â†‘ â†“)
zstyle ':completion:*' rehash true           # Actualiza la lista de comandos, cada que se instalen nuevos
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# zstyle ':completion:*' verbose yes
zstyle ':fzf-tab:*' use-fzf-default-opts yes # # https://github.com/Aloxaf/fzf-tab#configure

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# â•“
# â•‘ Zoxide: recuerda los directorios mÃ¡s frecuentados
# â•‘ Es como cd, pero utilizando el comando z
# â•‘ Requiere: pacman -S zoxide
# â•™
eval "$(zoxide init zsh)"
# eval "$(zoxide init --cmd cd zsh)"
# â•“
# â•‘ IntegraciÃ³n oficial de fzf
# â•‘ Proporciona bÃºsquedas interactivas y Ctrl+R mejorado
# â•‘ Requiere: pacman -S fzf
# â•™
source <(fzf --zsh)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ’¤ LÃ­neas desactivadas (referencia o pruebas)

# Starship prompt (no en uso actualmente)
# Requiere: pacman -S starship
# eval "$(starship init zsh)"
# https://git.nvds.be/NicolaiVdS/Dotfiles/src/commit/66cf71c398c811521d1959c0dbdd19213e2e73ef/.zshrc
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Cargar configuraciÃ³n de Powerlevel10k (si existe)
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

# Coloca esto al final de tu ~/.zshrc
zprof
